<!DOCTYPE html>
<html>
<head>
  <title>Schedule Management</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container py-4">
    <h2>Schedule Management</h2>

    <!-- Add Schedule Form -->
    <form method="POST" action="/admin/schedules/add" class="row g-3 mb-4">
      <div class="col-md-2">
        <select name="TrainID" class="form-select" required>
          <option value="">Select Train</option>
          <% trains.forEach(t => { %>
            <option value="<%= t.TrainID %>"><%= t.TrainName %></option>
          <% }) %>
        </select>
      </div>
      <div class="col-md-2">
        <select name="RouteID" class="form-select" required>
          <option value="">Select Route</option>
          <% routes.forEach(r => { %>
            <option value="<%= r.RouteID %>">Route <%= r.RouteID %>: <%= r.SourceStationID %> ➝ <%= r.DestinationStationID %></option>
          <% }) %>
        </select>
      </div>
      <div class="col-md-2"><input name="DepartureTime" class="form-control" type="datetime-local" required></div>
      <div class="col-md-2"><input name="ArrivalTime" class="form-control" type="datetime-local" required></div>
      <div class="col-md-2"><input name="TotalSeats" class="form-control" type="number" placeholder="Seats" required></div>
      <div class="col-md-2"><button class="btn btn-primary">Add Schedule</button></div>
    </form>

    <!-- Schedule Table -->
    <table class="table table-bordered table-hover">
      <thead class="table-dark">
        <tr>
          <th>ID</th><th>Train</th><th>Route</th><th>Departure</th><th>Arrival</th><th>Seats</th><th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% schedules.forEach(s => { %>
          <tr>
            <form method="POST" action="/admin/schedules/edit/<%= s.ScheduleID %>">
              <td><%= s.ScheduleID %></td>
              <td>
                <select name="TrainID" class="form-select">
                  <% trains.forEach(t => { %>
                    <option value="<%= t.TrainID %>" <%= t.TrainID === s.TrainID ? 'selected' : '' %>><%= t.TrainName %></option>
                  <% }) %>
                </select>
              </td>
              <td>
                <select name="RouteID" class="form-select">
                  <% routes.forEach(r => { %>
                    <option value="<%= r.RouteID %>" <%= r.RouteID === s.RouteID ? 'selected' : '' %>>
                      Route <%= r.RouteID %>: <%= r.SourceStationID %> ➝ <%= r.DestinationStationID %>
                    </option>
                  <% }) %>
                </select>
              </td>
              <td><input name="DepartureTime" class="form-control" type="datetime-local" value="<%= s.DepartureTime.slice(0, 16) %>"></td>
              <td><input name="ArrivalTime" class="form-control" type="datetime-local" value="<%= s.ArrivalTime.slice(0, 16) %>"></td>
              <td><input name="TotalSeats" class="form-control" type="number" value="<%= s.TotalSeats %>"></td>
              <td>
                <button class="btn btn-sm btn-success">Save</button>
                <form method="POST" action="/admin/schedules/delete/<%= s.ScheduleID %>" style="display:inline;">
                  <button class="btn btn-sm btn-danger" onclick="return confirm('Delete schedule?')">Delete</button>
                </form>
              </td>
            </form>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>
</body>
</html>
