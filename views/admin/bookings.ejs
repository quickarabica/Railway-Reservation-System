<!DOCTYPE html>
<html>
<head>
  <title>Booking Management</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container py-4">
    <h2>Booking Management</h2>

<form method="POST" action="/admin/bookings/add" class="row g-3 mb-4">
  <div class="col-md-2">
    <select name="UserID" class="form-select" required>
      <% users.forEach(u => { %>
        <option value="<%= u.UserID %>"><%= u.Username %></option>
      <% }) %>
    </select>
  </div>
  <div class="col-md-2">
    <select name="ScheduleID" class="form-select" required>
      <% schedules.forEach(s => { %>
        <option value="<%= s.ScheduleID %>">#<%= s.ScheduleID %> @ <%= s.DepartureTime %></option>
      <% }) %>
    </select>
  </div>
  <div class="col-md-2"><input name="TotalFare" type="number" step="0.1" class="form-control" placeholder="Fare" required></div>
  <div class="col-md-2">
    <select name="Status" class="form-select">
      <option value="Pending">Pending</option>
      <option value="Confirmed">Confirmed</option>
      <option value="Cancelled">Cancelled</option>
    </select>
  </div>
  <div class="col-md-2"><button class="btn btn-primary">Add Booking</button></div>
</form>

<table class="table table-bordered">
  <thead><tr><th>ID</th><th>User</th><th>Schedule</th><th>Status</th><th>Fare</th><th>Actions</th></tr></thead>
  <tbody>
    <% bookings.forEach(b => { %>
      <tr>
        <form method="POST" action="/admin/bookings/edit/<%= b.BookingID %>">
          <td><%= b.BookingID %></td>
          <td>
            <select name="UserID" class="form-select">
              <% users.forEach(u => { %>
                <option value="<%= u.UserID %>" <%= u.UserID === b.UserID ? 'selected' : '' %>><%= u.Username %></option>
              <% }) %>
            </select>
          </td>
          <td>
            <select name="ScheduleID" class="form-select">
              <% schedules.forEach(s => { %>
                <option value="<%= s.ScheduleID %>" <%= s.ScheduleID === b.ScheduleID ? 'selected' : '' %>>#<%= s.ScheduleID %> @ <%= s.DepartureTime %></option>
              <% }) %>
            </select>
          </td>
          <td>
            <select name="Status" class="form-select">
              <option <%= b.Status === "Pending" ? 'selected' : '' %>>Pending</option>
              <option <%= b.Status === "Confirmed" ? 'selected' : '' %>>Confirmed</option>
              <option <%= b.Status === "Cancelled" ? 'selected' : '' %>>Cancelled</option>
            </select>
          </td>
          <td><input name="TotalFare" type="number" step="0.1" class="form-control" value="<%= b.TotalFare %>"></td>
          <td>
            <button class="btn btn-success btn-sm">Save</button>
            <form method="POST" action="/admin/bookings/delete/<%= b.BookingID %>" style="display:inline;">
              <button class="btn btn-danger btn-sm" onclick="return confirm('Delete booking?')">Delete</button>
            </form>
          </td>
        </form>
      </tr>
    <% }) %>
  </tbody>
</table>
</div>
</body>
</html>